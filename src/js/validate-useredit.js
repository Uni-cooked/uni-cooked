import{createError as e,eliminateError as t,ToggleConfirmButton as n,ShowPsw as l,ToggleLabel as i}from"./utils.js";function ValidateProfile(e){validateUsername()||e.preventDefault()}function ValidateNewPsw(e){validateOldPassword()&&validateNewPassword()&&validateNewPasswordConfirm()||e.preventDefault()}function ToggleConfirmModButton(){let e=document.getElementById("nickname-edit").value.trim();e.length<1||e.length>15?n(0):n(1)}function ToggleConfirmPswButton(){let e=document.getElementById("old-psw").value.trim(),t=document.getElementById("new-psw").value.trim(),l=document.getElementById("repeat-new-psw").value.trim();""==e||t.length<4||""==l?n(0,"second-btn-confirm"):n(1,"second-btn-confirm")}function validateUsername(){let n=document.getElementById("nickname-edit"),l=n.value.trim(),i=document.getElementById("err-edit-nam");if(t(i),l.length<1){let a=e("err-edit-nam");a.innerText="Il nome utente \xe8 un campo obbligatorio";let r=n.parentNode;return r.appendChild(a),!1}if(l.length>15){let o=e("err-edit-nam");o.innerText="Il nome utente non deve essere pi\xf9 lungo di 15 caratteri";let d=n.parentNode;return d.appendChild(o),!1}if(-1==l.search(/^[a-zA-ZÀ-Ýß-ÿ0-9]{1,15}$/)){let s=e("err-edit-nam");s.innerHTML="Nome utente non valido, usa solo lettere o numeri.";let p=n.parentNode;return p.appendChild(s),!1}return!0}async function ChangeImage(){let n=document.getElementById("profile-img-edit"),[l]=n.files;document.getElementById("del-pp-radio").checked=!1,i(1,"del-pp-radio"),i(1,"del-pp");let a=document.getElementById("chosen-image"),r=new FileReader;r.onload=i=>{let r=l.size,o=document.getElementById("profile-pic-err-p");if(t(o),2048>Math.round(r/1024)){if(["image/png","image/jpeg"].includes(l.type))a.setAttribute("src",i.target.result);else{let d=e("profile-pic-err-p");d.innerHTML="L'estensione del <span lang='en'>file</span> caricato non \xe8 corretta";let s=document.getElementById("edit-pp");s.append(d),n.value=null}}else{let p=e("profile-pic-err-p");p.innerHTML="Sono accettati solo <span lang='en'>file</span> di dimensione minore a 2<span lang='en' abbr='megabyte'>MB</span>";let g=document.getElementById("edit-pp");g.append(p)}},r.readAsDataURL(l)}function ToggleChangeImage(){i(0,"del-pp");let e=document.getElementById("chosen-image");e.setAttribute("src","./asset/img/def-profile.webp")}function validateOldPassword(){let n=document.getElementById("old-psw"),l=n.value.trim(),i=document.getElementById("err-old-psw");if(t(i),l.length<1){let a=e("err-old-psw");a.innerText="La <span lang='en'>password</span> \xe8 un campo obbligatorio";let r=n.parentNode;return r.appendChild(a),!1}return!0}function validateNewPassword(){let n=document.getElementById("new-psw"),l=n.value.trim(),i=document.getElementById("err-new-psw");if(t(i),l.length<4){let a=e("err-new-psw");a.innerHTML="La <span lang='en'>password</span> deve essere lunga almeno 4 caratteri";let r=n.parentNode;return r.appendChild(a),!1}if(-1==l.search(/^(?=.*[a-zß-ÿ])(?=.*[A-ZÀ-Ý])(?=.*[\d])(?=.*[.,!?@+\-_€$%&^*<>]).{4,}$/)){let o=e("err-new-psw");o.innerHTML="La <span lang='en'>password</span> deve avere almeno una lettera maiuscola, una minuscola, un numero e un carattere speciale";let d=n.parentNode;return d.appendChild(o),!1}return!0}function validateNewPasswordConfirm(){let n=document.getElementById("repeat-new-psw"),l=document.getElementById("new-psw").value.trim(),i=n.value.trim(),a=document.getElementById("err-repeat-new-psw");if(t(a),l!=i){let r=e("err-repeat-new-psw");r.innerHTML="Le <span lang='en'>password</lang> non coincidono";let o=n.parentNode;return o.appendChild(r),!1}return!0}let listeners={"nickname-edit":{focusout:validateUsername,input:ToggleConfirmModButton},"profile-img-edit":{change:ChangeImage,input:ToggleConfirmModButton},"del-pp-radio":{change:ToggleChangeImage},"old-psw":{focusout:validateOldPassword,input:ToggleConfirmPswButton},"new-psw":{focusout:validateNewPassword,input:ToggleConfirmPswButton},"repeat-new-psw":{focusout:validateNewPasswordConfirm,input:ToggleConfirmPswButton},"show-old-psw":{click:function(){l(this,"old-psw")}},"show-new-psw":{click:function(){l(this,"new-psw")}},"show-rep-psw":{click:function(){l(this,"repeat-new-psw")}},"new-info":{submit:ValidateProfile},credentials:{submit:ValidateNewPsw,reset:ToggleConfirmPswButton}};function InitListeners(){for(let e in listeners){if(!document.getElementById(e))continue;let t=document.getElementById(e);for(let n in listeners[e])t.addEventListener(n,listeners[e][n])}let l=document.getElementById("new-info"),a=document.getElementById("chosen-image"),r=a.getAttribute("src"),o=document.getElementById("del-pp-radio").disabled;l.addEventListener("reset",()=>{o?(i(0,"del-pp-radio"),i(0,"del-pp")):(i(1,"del-pp-radio"),i(1,"del-pp")),i(1,"profile-img-edit"),i(1,"mod-pp"),a.setAttribute("src",r)})}window.addEventListener("load",function(){InitListeners(),n(0,"second-btn-confirm")});