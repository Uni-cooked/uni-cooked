import{createError as e,eliminateError as n,ToggleConfirmButton as t,ShowPsw as i,ToggleLabel as l,RemoveAllErrors as a}from"./utils.js";function ValidateProfile(e){validateUsername()||e.preventDefault()}function ValidateNewPsw(e){validateOldPassword()&&validateNewPassword()&&validateNewPasswordConfirm()||e.preventDefault()}function ToggleConfirmModButton(){let e=document.getElementById("nickname-edit").value.trim();e.length<1||e.length>15?t(0):t(1)}function ToggleConfirmPswButton(){let e=document.getElementById("old-psw").value.trim(),n=document.getElementById("new-psw").value.trim(),i=document.getElementById("repeat-new-psw").value.trim();""==e||n.length<4||""==i?t(0,"second-btn-confirm"):t(1,"second-btn-confirm")}function validateUsername(){let t=document.getElementById("nickname-edit"),i=t.value.trim(),l=document.getElementById("err-edit-nam");if(n(l),i.length<1){let a=e("err-edit-nam");a.innerText="Il nome utente \xe8 un campo obbligatorio";let r=t.parentNode;return r.appendChild(a),!1}if(i.length>15){let o=e("err-edit-nam");o.innerText="Il nome utente non deve essere pi\xf9 lungo di 15 caratteri";let d=t.parentNode;return d.appendChild(o),!1}if(-1==i.search(/^[a-zA-ZÀ-Ýß-ÿ0-9]{1,15}$/)){let s=e("err-edit-nam");s.innerHTML="Nome utente non valido, usa solo lettere o numeri.";let p=t.parentNode;return p.appendChild(s),!1}return!0}async function ChangeImage(){let t=document.getElementById("profile-img-edit"),[i]=t.files;document.getElementById("del-pp-radio").checked=!1;let a=document.getElementById("chosen-image"),r=new FileReader;r.onload=r=>{let o=i.size,d=document.getElementById("profile-pic-err-p");if(n(d),2048>Math.round(o/1024)){if(["image/png","image/jpeg"].includes(i.type))a.setAttribute("src",r.target.result),l(1,"del-pp-radio"),l(1,"del-pp");else{let s=e("profile-pic-err-p");s.innerHTML="L'estensione del <span lang='en'>file</span> caricato non \xe8 corretta";let p=document.getElementById("edit-pp");p.append(s),t.value=null}}else{let m=e("profile-pic-err-p");m.innerHTML="Sono accettati solo <span lang='en'>file</span> di dimensione minore a 2<span lang='en' abbr='megabyte'>MB</span>";let g=document.getElementById("edit-pp");g.append(m)}},r.readAsDataURL(i)}function ToggleChangeImage(){l(0,"del-pp");let e=document.getElementById("chosen-image");e.setAttribute("src","./asset/img/def-profile.webp")}function validateOldPassword(){let t=document.getElementById("old-psw"),i=t.value.trim(),l=document.getElementById("err-old-psw");if(n(l),i.length<1){let a=e("err-old-psw");a.innerHTML="La <span lang='en'>password</span> \xe8 un campo obbligatorio";let r=t.parentNode;return r.appendChild(a),!1}return!0}function validateNewPassword(){let t=document.getElementById("new-psw"),i=t.value.trim(),l=document.getElementById("err-new-psw");if(n(l),i.length<4){let a=e("err-new-psw");a.innerHTML="La <span lang='en'>password</span> deve essere lunga almeno 4 caratteri";let r=t.parentNode;return r.appendChild(a),!1}if(-1==i.search(/^(?=.*[a-zß-ÿ])(?=.*[A-ZÀ-Ý])(?=.*[\d])(?=.*[.,!?@+\-_€$%&^*<>]).{4,}$/)){let o=e("err-new-psw");o.innerHTML="La <span lang='en'>password</span> deve avere almeno una lettera maiuscola, una minuscola, un numero e un carattere speciale";let d=t.parentNode;return d.appendChild(o),!1}return!0}function validateNewPasswordConfirm(){let t=document.getElementById("repeat-new-psw"),i=document.getElementById("new-psw").value.trim(),l=t.value.trim(),a=document.getElementById("err-repeat-new-psw");if(n(a),i!=l){let r=e("err-repeat-new-psw");r.innerHTML="Le <span lang='en'>password</lang> non coincidono";let o=t.parentNode;return o.appendChild(r),!1}return!0}let listeners={"nickname-edit":{focusout:validateUsername,input:ToggleConfirmModButton},"profile-img-edit":{change:ChangeImage,input:ToggleConfirmModButton},"del-pp-radio":{change:ToggleChangeImage},"old-psw":{focusout:validateOldPassword,input:ToggleConfirmPswButton},"new-psw":{focusout:validateNewPassword,input:ToggleConfirmPswButton},"repeat-new-psw":{focusout:validateNewPasswordConfirm,input:ToggleConfirmPswButton},"show-old-psw":{click:function(){i(this,"old-psw")}},"show-new-psw":{click:function(){i(this,"new-psw")}},"show-rep-psw":{click:function(){i(this,"repeat-new-psw")}},"new-info":{submit:ValidateProfile},credentials:{submit:ValidateNewPsw,reset(){ToggleConfirmPswButton(),a("#credentials")}}};function InitListeners(){for(let e in listeners){if(!document.getElementById(e))continue;let n=document.getElementById(e);for(let t in listeners[e])n.addEventListener(t,listeners[e][t])}let i=document.getElementById("new-info"),r=document.getElementById("chosen-image"),o=r.getAttribute("src"),d=document.getElementById("del-pp-radio").disabled;i.addEventListener("reset",()=>{d?(l(0,"del-pp-radio"),l(0,"del-pp")):(l(1,"del-pp-radio"),l(1,"del-pp")),l(1,"profile-img-edit"),l(1,"mod-pp"),r.setAttribute("src",o),a("#new-info")})}window.addEventListener("load",function(){InitListeners(),t(0,"second-btn-confirm")});